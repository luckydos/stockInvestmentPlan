<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Stock Investment Plan</title>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css" />
	<style>
		/* ëª¨ë“  ìš”ì†Œì˜ ë„ˆë¹„ ê³„ì‚°ì— íŒ¨ë”©/í…Œë‘ë¦¬ í¬í•¨ */
		* {
			box-sizing: border-box;
		}

		:root {
			--bg-body: #f5f7fa;
			--bg-card: #ffffff;
			--text-main: #333333;
			--text-sub: #666666;
			--border-color: #e0e0e0;
			--header-bg: #495057;
			/* í†¤ë‹¤ìš´ëœ ë‹¤í¬ ê·¸ë ˆì´ */
			--color-up: #e31b23;
			--color-down: #0051c7;
			--color-danger: #6f42c1;
			--badge-buy: #e31b23;
			--badge-sell: #0051c7;
			--badge-hold: #868e96;
			--tab-active-text: #111;
			--tab-inactive-text: #999;
			--segment-bg: #e9ecef;
			--badge-loading: #f39c12;
		}

		body {
			font-family: 'Pretendard', sans-serif;
			background-color: var(--bg-body);
			margin: 0;
			padding: 40px 15px;
			color: var(--text-main);
			transition: background-color 0.3s ease;
			overflow-y: scroll;
			overflow-x: hidden;
		}

		.container {
			max-width: 1600px;
			margin: 0 auto;
			transition: all 0.3s ease;
			width: 100%;
		}

		/* --- ê³µí†µ ìœ í‹¸ë¦¬í‹° --- */
		.up {
			color: var(--color-up) !important;
			font-weight: 700;
		}

		.down {
			color: var(--color-down) !important;
			font-weight: 700;
		}

		.badge {
			display: inline-block;
			padding: 6px 10px;
			border-radius: 6px;
			font-size: 13px;
			font-weight: 600;
			color: white;
			text-align: center;
			min-width: 65px;
			line-height: 1.2;
		}

		.badge.buy {
			background: var(--badge-buy);
		}

		.badge.sell {
			background: var(--badge-sell);
		}

		.badge.hold {
			background: var(--badge-hold);
		}

		.badge.nodata {
			background: #e9ecef;
			color: #adb5bd;
		}

		.badge.loading {
			background: var(--badge-loading);
		}

		/* --- í—¤ë” & ë²„íŠ¼ --- */
		.dashboard-header {
			margin-bottom: 20px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.dashboard-title h2 {
			margin: 0;
			font-size: 28px;
			font-weight: 800;
			color: #2c3e50;
		}

		.btn-group {
			display: flex;
			gap: 8px;
		}

		.action-btn {
			background: #fff;
			border: 1px solid var(--border-color);
			border-radius: 8px;
			padding: 10px 16px;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			gap: 6px;
			align-items: center;
			color: var(--text-sub);
			transition: all 0.2s;
			white-space: nowrap;
		}

		.action-btn:hover {
			background: #f8f9fa;
			color: #333;
			border-color: #bbb;
		}

		.action-btn.primary {
			background-color: #2c3e50;
			color: white;
			border-color: #2c3e50;
		}

		.action-btn.primary:hover {
			background-color: #1a252f;
			border-color: #1a252f;
		}

		.toolbar {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
			position: relative;
			z-index: 10;
		}

		.tabs-group {
			display: flex;
			background-color: var(--segment-bg);
			padding: 4px;
			border-radius: 12px;
			width: fit-content;
		}

		.tab-btn {
			padding: 10px 24px;
			border: none;
			background: transparent;
			border-radius: 10px;
			font-weight: 600;
			color: var(--tab-inactive-text);
			cursor: pointer;
			display: flex;
			gap: 8px;
			align-items: center;
			transition: all 0.2s ease;
		}

		.tab-btn.active {
			background: var(--bg-card);
			color: var(--tab-active-text);
			font-weight: 700;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
		}

		.time-display {
			font-size: 13px;
			color: #666;
			background: #fff;
			padding: 6px 16px;
			border-radius: 20px;
			border: 1px solid var(--border-color);
		}

		.content-section {
			display: none;
			background: var(--bg-card);
			border: 1px solid var(--border-color);
			border-radius: 12px;
			padding: 0px;
		}

		.content-section.active {
			display: block;
		}

		/* --- PC View Styles --- */
		.pc-view {
			display: block;
		}

		.mobile-view {
			display: none;
		}

		.table-responsive {
			width: 100%;
			border-radius: 8px;
			overflow: hidden;

			border: 1px solid var(--border-color);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
			-webkit-overflow-scrolling: touch;
		}

		table {
			table-layout: fixed;
			width: 100%;
			border-collapse: separate;
			border-spacing: 0;
		}

		th {
			background: var(--header-bg) !important;
			color: #ffffff !important;
			font-weight: 500 !important;
			padding: 16px 8px !important;
			border: none !important;
			outline: none !important;
			border-bottom: 1px solid #5d6369 !important;
			text-align: center;
			position: sticky;
			top: 0;
			z-index: 10;
			white-space: nowrap;
			font-size: 14px;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		td {
			padding: 14px 8px;
			border-bottom: 1px solid var(--border-color);
			border-right: none !important;
			border-left: none !important;
			text-align: right;
			font-size: 14px;
			color: #333;
			vertical-align: middle;
		}

		th:first-child {
			position: sticky;
			left: 0;
			z-index: 30;
			background: var(--header-bg) !important;
			color: #ffffff !important;
			box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
			border: none !important;
			border-bottom: 1px solid #5d6369 !important;
		}

		td:first-child {
			position: sticky;
			left: 0;
			z-index: 20;
			background: #fff;
			text-align: center;
			box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
			border-right: none !important;
			border-left: none !important;
		}

		tbody tr:hover td {
			background-color: #f8f9fa;
		}

		tbody tr:hover td:first-child {
			background-color: #f8f9fa;
		}

		/* --- [ì¶”ê°€] ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ --- */
		@keyframes slideExpand {
			0% {
				opacity: 0;
				transform: translateY(-20px);
				max-height: 0;
			}

			100% {
				opacity: 1;
				transform: translateY(0);
				max-height: 1000px;
				/* ì¶©ë¶„í•œ ë†’ì´ */
			}
		}

		.anim-row {
			opacity: 0;
			/* ì´ˆê¸°ì—” ìˆ¨ê¹€ */
			animation: slideExpand 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
		}

		.name-wrapper {
			display: flex;
			flex-direction: column;
			gap: 3px;
			line-height: 1.2;
			text-align: left;
			padding-left: 8px;
			position: relative;
		}

		.name-row {
			display: flex;
			align-items: center;
			gap: 6px;
			justify-content: flex-start;
		}

		.btn-edit-stock {
			background: none;
			border: none;
			color: #ccc;
			cursor: pointer;
			font-size: 11px;
			padding: 2px;
			transition: color 0.2s;
		}

		.btn-edit-stock:hover {
			color: #333;
		}

		.stock-name {
			font-weight: 700;
			color: #212529;
			font-size: 15px;
			display: block;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.stock-code {
			font-size: 11px;
			color: #999;
			display: block;
		}

		.input-val {
			background-color: #fcfcfc;
			color: #495057;
			text-align: center;
		}

		.graph-wrapper {
			display: flex;
			align-items: center;
			justify-content: flex-end;
			gap: 6px;
			width: 100%;
			margin-left: auto;
		}

		.bar-track {
			flex-grow: 1;
			height: 6px;
			background: #eee;
			border-radius: 3px;
			overflow: hidden;
			display: flex;
			min-width: 30px;
		}

		.bar-fill {
			height: 100%;
			border-radius: 4px;
		}

		/* --- Mobile View Styles (Card) --- */
		.mobile-card {
			background: #fff;
			border: 1px solid var(--border-color);
			border-radius: 12px;
			margin-bottom: 16px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
			position: relative;
			overflow: hidden;
		}

		.mobile-edit-btn {
			position: static;
			background: none;
			border: none;
			color: rgba(255, 255, 255, 0.5);
			font-size: 13px;
			padding: 2px 6px;
			cursor: pointer;
			transition: color 0.2s;
		}

		.mobile-edit-btn:hover {
			color: #fff;
		}

		.m-header {
			display: flex;
			justify-content: space-between;
			align-items: flex-start;
			background-color: var(--header-bg);
			padding: 16px 20px;
			border-bottom: none;
		}

		.m-stock-info h3 {
			margin: 0;
			font-size: 18px;
			font-weight: 700;
			color: #ffffff;
			display: flex;
			align-items: center;
			gap: 4px;
		}

		.m-stock-info span {
			font-size: 13px;
			color: #adb5bd;
			margin-top: 2px;
			display: block;
		}

		.m-body {
			display: flex;
			flex-direction: column;
			gap: 16px;
			padding: 20px;
		}

		.m-price-row {
			display: flex;
			justify-content: space-between;
			align-items: flex-end;
		}

		.m-current-price {
			font-size: 24px;
			font-weight: 800;
			color: #333;
			letter-spacing: -0.5px;
		}

		.m-target-price {
			font-size: 13px;
			color: #888;
			text-align: right;
		}

		.m-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
			background: #f8f9fa;
			padding: 12px;
			border-radius: 8px;
		}

		.m-grid-item {
			text-align: center;
		}

		.m-grid-label {
			display: block;
			font-size: 11px;
			color: #888;
			margin-bottom: 4px;
		}

		.m-grid-value {
			display: block;
			font-size: 14px;
			font-weight: 600;
			color: #333;
		}

		.m-graphs {
			display: flex;
			gap: 10px;
			padding-bottom: 4px;
		}

		.m-bar-group {
			flex: 1;
		}

		.m-bar-label {
			display: flex;
			justify-content: space-between;
			font-size: 11px;
			color: #666;
			margin-bottom: 4px;
		}

		.m-bar-bg {
			height: 6px;
			background: #eee;
			border-radius: 3px;
			overflow: hidden;
		}

		.m-bar-fill {
			height: 100%;
			border-radius: 3px;
		}

		.spinner {
			display: block;
			width: 32px;
			height: 32px;
			margin: 0;
			border: 3px solid rgba(0, 0, 0, 0.1);
			border-radius: 50%;
			border-top-color: #2c3e50;
			animation: spin 1s infinite linear;
		}

		@keyframes spin {
			to {
				transform: rotate(360deg);
			}
		}

		.loading-msg {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			gap: 15px;
			min-height: 50vh;
			width: 100%;
			color: #868e96;
			font-weight: 500;
			font-size: 15px;
		}

		/* [ìˆ˜ì •] ì „ì²´ í™”ë©´ ë¡œë”© ì˜¤ë²„ë ˆì´ (ì´ˆê¸° ë¡œë”© ì‹œ ì‚¬ìš©) */
		.page-loading-overlay {
			display: flex;
			/* ì´ˆê¸°ê°’ flexë¡œ ì„¤ì •í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì „ê¹Œì§€ ë³´ì„ */
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(255, 255, 255, 0.9);
			z-index: 9999;
			justify-content: center;
			align-items: center;
			flex-direction: column;
		}

		.page-loading-overlay.hidden {
			display: none;
		}

		/* --- Modal Styles --- */
		.modal-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
			z-index: 1000;
			justify-content: center;
			align-items: center;
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		.modal-overlay.open {
			display: flex;
			opacity: 1;
		}

		.modal-window {
			background: white;
			padding: 24px;
			border-radius: 16px;
			width: 90%;
			max-width: 450px;
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
			transform: translateY(20px);
			transition: transform 0.3s ease;
		}

		.modal-overlay.open .modal-window {
			transform: translateY(0);
		}

		.modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
		}

		.modal-header h3 {
			margin: 0;
			font-size: 20px;
			color: #2c3e50;
		}

		.modal-close {
			background: none;
			border: none;
			font-size: 20px;
			cursor: pointer;
			color: #999;
		}

		.form-group {
			margin-bottom: 16px;
		}

		.form-group label {
			display: block;
			margin-bottom: 6px;
			font-size: 13px;
			font-weight: 600;
			color: #555;
		}

		.form-control {
			width: 100%;
			padding: 10px 12px;
			border: 1px solid #e0e0e0;
			border-radius: 8px;
			font-size: 14px;
			font-family: inherit;
			outline: none;
		}

		.form-control:focus {
			border-color: #2c3e50;
		}

		.form-control:disabled {
			background-color: #f5f5f5;
			color: #aaa;
			cursor: not-allowed;
		}

		.form-row {
			display: flex;
			gap: 10px;
		}

		.modal-footer {
			margin-top: 24px;
			display: flex;
			gap: 10px;
			justify-content: flex-end;
		}

		/* --- Logic View Mode Toggle --- */
		@media (max-width: 768px) {
			body:not(.force-pc) .pc-view {
				display: none !important;
			}

			body:not(.force-pc) .mobile-view {
				display: block !important;
			}

			body {
				padding: 15px 10px;
				background-color: #f0f2f5;
			}

			.container {
				margin: 0;
				max-width: 100%;
			}

			.dashboard-header {
				flex-direction: column;
				gap: 10px;
				align-items: stretch;
			}

			.btn-group {
				width: 100%;
			}

			.action-btn {
				flex: 1;
				justify-content: center;
			}

			.toolbar {
				flex-direction: column;
				gap: 10px;
				align-items: stretch;
			}

			.tabs-group {
				width: 100%;
			}

			.tab-btn {
				flex: 1;
				justify-content: center;
			}

			.time-display {
				width: 100%;
				text-align: right;
				background: transparent;
				border: none;
				padding: 0;
			}

			.time-display i {
				display: none;
			}

			.content-section {
				padding: 0;
				background: transparent;
				border: none;
				box-shadow: none;
			}
		}

		body.force-mobile {
			background-color: #2c3e50 !important;
			overflow: hidden;
		}

		body.force-mobile .container {
			max-width: 420px;
			height: 90vh;
			margin: 20px auto;
			background-color: #f0f2f5;
			padding: 20px 15px;
			border-radius: 20px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
			overflow-y: auto;
			display: block;
		}

		body.force-mobile .pc-view {
			display: none !important;
		}

		body.force-mobile .mobile-view {
			display: block !important;
		}

		body.force-mobile .dashboard-header {
			flex-direction: column;
			gap: 10px;
			align-items: stretch;
		}

		body.force-mobile .btn-group {
			width: 100%;
		}

		body.force-mobile .action-btn {
			flex: 1;
			justify-content: center;
		}

		body.force-mobile .toolbar {
			flex-direction: column;
			gap: 10px;
			align-items: stretch;
		}

		body.force-mobile .tabs-group {
			width: 100%;
		}

		body.force-mobile .tab-btn {
			flex: 1;
			justify-content: center;
		}

		body.force-mobile .time-display {
			width: 100%;
			text-align: right;
			background: transparent;
			border: none;
			padding: 0;
		}

		body.force-mobile .time-display i {
			display: none;
		}

		body.force-mobile .content-section {
			padding: 0;
			background: transparent;
			border: none;
			box-shadow: none;
		}

		body.force-pc {
			overflow-x: auto;
			background-color: var(--bg-body);
		}

		body.force-pc .container {
			width: 100%;
			max-width: 100%;
			padding: 0 5px;
		}

		body.force-pc .pc-view {
			display: block !important;
		}

		body.force-pc .mobile-view {
			display: none !important;
		}

		body.force-pc .table-responsive {
			display: block;
			width: 100%;
			overflow-x: auto;
			-webkit-overflow-scrolling: touch;
		}

		body.force-pc table {
			width: 1600px !important;
			min-width: 1600px !important;
		}

		body.force-pc table colgroup col:first-child {
			width: 8% !important;
		}
	</style>
</head>

<body>
	<div id="pageLoading" class="page-loading-overlay">
		<div class="spinner"></div>
		<div style="margin-top: 15px; color: #555; font-weight: 600;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
	</div>

	<div class="container">
		<div class="dashboard-header">
			<div class="dashboard-title">
				<h2>Stock Investment Plan</h2>
			</div>
			<div class="btn-group">
				<button class="action-btn primary" onclick="toggleModal('add')">
					<i class="fas fa-plus"></i> <span>ì¢…ëª© ì¶”ê°€</span>
				</button>
				<button id="viewToggleBtn" class="action-btn" onclick="toggleViewMode()">
					<i class="fas fa-mobile-alt"></i> <span>ëª¨ë°”ì¼ í™”ë©´</span>
				</button>
				<button class="action-btn" onclick="handleReload()">
					<i class="fas fa-rotate-right"></i> <span>ìƒˆë¡œê³ ì¹¨</span>
				</button>
			</div>
		</div>

		<div class="toolbar">
			<div class="tabs-group">
				<button id="tab-btn-korea" class="tab-btn active" onclick="switchTab('korea')">
					<span class="fi fi-kr"></span> í•œêµ­ ì£¼ì‹
				</button>
				<button id="tab-btn-usa" class="tab-btn" onclick="switchTab('usa')">
					<span class="fi fi-us"></span> ë¯¸êµ­ ì£¼ì‹
				</button>
			</div>
			<div class="time-display">
				<i class="far fa-clock"></i>
				<span id="globalTime">ì—…ë°ì´íŠ¸ ëŒ€ê¸°ì¤‘...</span>
			</div>
		</div>

		<div id="korea" class="content-section active">
			<div class="pc-view table-responsive">
				<table id="tableKorea">
					<colgroup>
						<col style="width: 10%;">
						<col style="width: 5%;">
						<col style="width: 5%;">
						<col style="width: 5%;">
						<col style="width: 6%;">
						<col style="width: 7%;">
						<col style="width: 10%;">
						<col style="width: 6%;">
						<col style="width: 10%;">
						<col style="width: 7%;">
						<col style="width: 4%;">
						<col style="width: 6%;">
						<col style="width: 4%;">
						<col style="width: 5%;">
						<col style="width: 5%;">
						<col style="width: 5%;">
					</colgroup>
					<thead>
						<tr>
							<th>ê¸°ì—…ëª…</th>
							<th class="input-val">ëª©í‘œ<br>ë°°ë‹¹ë¥ (%)</th>
							<th class="input-val">ëª©í‘œ<br>PER(ë°°)</th>
							<th>Action</th>
							<th>ëª©í‘œê°€</th>
							<th>í˜„ì¬ê°€</th>
							<th>ë“±ë½ë¥ </th>
							<th>52ì£¼ ìµœê³ </th>
							<th>ê³ ì  ëŒ€ë¹„</th>
							<th>ì‹œê°€ì´ì•¡<br><span style="font-size:0.85em">(AUM)</span></th>
							<th>PER</th>
							<th>EPS</th>
							<th>PBR</th>
							<th>ë°°ë‹¹ë¥ </th>
							<th>ë°°ë‹¹ê¸ˆ</th>
							<th>ë°°ë‹¹ì„±í–¥</th>
						</tr>
					</thead>
					<tbody id="tbodyKorea"></tbody>
				</table>
			</div>
			<div id="listKorea" class="mobile-view"></div>
		</div>

		<div id="usa" class="content-section">
			<div class="pc-view table-responsive">
				<table id="tableUSA">
					<colgroup>
						<col style="width: 10%;">
						<col style="width: 5%;">
						<col style="width: 5%;">
						<col style="width: 5%;">
						<col style="width: 6%;">
						<col style="width: 7%;">
						<col style="width: 10%;">
						<col style="width: 6%;">
						<col style="width: 10%;">
						<col style="width: 7%;">
						<col style="width: 4%;">
						<col style="width: 6%;">
						<col style="width: 4%;">
						<col style="width: 5%;">
						<col style="width: 5%;">
						<col style="width: 5%;">
					</colgroup>
					<thead>
						<tr>
							<th>ê¸°ì—…ëª…</th>
							<th class="input-val">ëª©í‘œ<br>ë°°ë‹¹ë¥ (%)</th>
							<th class="input-val">ëª©í‘œ<br>PER(ë°°)</th>
							<th>Action</th>
							<th>ëª©í‘œê°€</th>
							<th>í˜„ì¬ê°€</th>
							<th>ë“±ë½ë¥ </th>
							<th>52ì£¼ ìµœê³ </th>
							<th>ê³ ì  ëŒ€ë¹„</th>
							<th>ì‹œê°€ì´ì•¡<br><span style="font-size:0.85em">(AUM)</span></th>
							<th>PER</th>
							<th>EPS</th>
							<th>PBR</th>
							<th>ë°°ë‹¹ë¥ </th>
							<th>ë°°ë‹¹ê¸ˆ</th>
							<th>ë°°ë‹¹ì„±í–¥</th>
						</tr>
					</thead>
					<tbody id="tbodyUSA"></tbody>
				</table>
			</div>
			<div id="listUSA" class="mobile-view"></div>
		</div>
	</div>

	<div id="stockModal" class="modal-overlay" onmousedown="checkOverlayClick(event)"
		onclick="handleOverlayClick(event)">
		<div class="modal-window" onclick="event.stopPropagation()" onmousedown="event.stopPropagation()">
			<div class="modal-header">
				<h3 id="modalTitle">ê´€ì‹¬ ì¢…ëª© ì¶”ê°€</h3>
				<button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
			</div>
			<div class="modal-body">
				<input type="hidden" id="editOriginalCode">
				<input type="hidden" id="modalMode">

				<div class="form-group">
					<label>êµ­ê°€ ì„ íƒ</label>
					<select id="inputCountry" class="form-control" onchange="updatePlaceholders()">
						<option value="korea">ğŸ‡°ğŸ‡· í•œêµ­ ì£¼ì‹</option>
						<option value="usa">ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì£¼ì‹</option>
					</select>
				</div>
				<div class="form-row">
					<div class="form-group" style="flex:1">
						<label>ê¸°ì—…ëª…</label>
						<input type="text" id="inputName" class="form-control" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì">
					</div>
					<div class="form-group" style="flex:1">
						<label>ì¢…ëª©ì½”ë“œ (Ticker)</label>
						<input type="text" id="inputCode" class="form-control" placeholder="ì˜ˆ: 005930">
					</div>
				</div>
				<div class="form-row">
					<div class="form-group" style="flex:1">
						<label>ëª©í‘œ ë°°ë‹¹ë¥  (%)</label>
						<input type="text" id="inputDiv" class="form-control" placeholder="ìˆ«ìë§Œ ì…ë ¥"
							oninput="validateNumberInput(this); handleInputMutex('inputDiv', 'inputPer')">
					</div>
					<div class="form-group" style="flex:1">
						<label>ëª©í‘œ PER (ë°°)</label>
						<input type="text" id="inputPer" class="form-control" placeholder="ìˆ«ìë§Œ ì…ë ¥"
							oninput="validateNumberInput(this); handleInputMutex('inputPer', 'inputDiv')">
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button class="action-btn" onclick="closeModal()">ì·¨ì†Œ</button>
				<button id="modalSubmitBtn" class="action-btn primary" onclick="handleModalSubmit()">ì¶”ê°€í•˜ê¸°</button>
			</div>
		</div>
	</div>

	<script>
		// [ì¤‘ìš”] ë³¸ì¸ì˜ GAS API ì£¼ì†Œë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”
		const API_URL = "https://script.google.com/macros/s/AKfycbz80x6AyIftaDyqX68cyv3spp2x8gg14Rq1gPnb8NSToi0LInPgOkBbn2lflJSkd_8u/exec";

		let koreaStocks = [];
		let usaStocks = [];

		const FIX_SCALE_CHANGE = 0.3;
		const FIX_SCALE_DROP = 0.5;

		// [ì‹ ê·œ] ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ í•¸ë“¤ëŸ¬
		function handleReload() {
			// ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
			document.getElementById('pageLoading').classList.remove('hidden');

			// ì•½ê°„ì˜ ë”œë ˆì´ í›„ ìƒˆë¡œê³ ì¹¨ (ì‚¬ìš©ìê°€ ë¡œë”© í™”ë©´ì„ ì¸ì§€í•˜ë„ë¡)
			setTimeout(() => {
				location.reload();
			}, 100);
		}

		// ---------------- ì´ˆê¸° ë°ì´í„° ì¼ê´„ ë¡œë”© (Batch Load) ----------------

		// [ìˆ˜ì •] ì„¤ì • ë°ì´í„° ë¡œë“œ ë° ì´ˆê¸° ë°°ì¹˜ ë¡œë”© ì‹œì‘
		async function loadSheetConfig() {
			// ë¡œë”© ì˜¤ë²„ë ˆì´ í™•ì‹¤íˆ í‘œì‹œ
			document.getElementById('pageLoading').classList.remove('hidden');

			try {
				const res = await fetch(`${API_URL}?type=config`);
				const data = await res.json();

				const formatData = (item) => ({
					...item,
					targetDiv: (item.targetDiv && item.targetDiv <= 1) ? item.targetDiv * 100 : item.targetDiv,
					fetchedData: null,
					isLoading: null
				});

				koreaStocks = data.korea.map(formatData);
				usaStocks = data.usa.map(formatData);

				// [í•µì‹¬] ì„¤ì • ë¡œë“œ í›„, ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œì‘ (Promise.all)
				// í˜„ì¬ í™œì„±í™”ëœ íƒ­ì„ ë¨¼ì € ê·¸ë¦¬ê¸° ìœ„í•´ ë¡œì§ ë¶„ë¦¬ ê°€ëŠ¥í•˜ë‚˜, 
				// ìš”êµ¬ì‚¬í•­ëŒ€ë¡œ "ì™„ì „íˆ ê°€ì ¸ì˜¨ í›„" ë³´ì—¬ì£¼ê¸° ìœ„í•´ ë‘ êµ­ê°€ ëª¨ë‘ ë¡œë”© ëŒ€ê¸°
				await Promise.all([
					batchFetchStocks(koreaStocks),
					batchFetchStocks(usaStocks)
				]);

				// ëª¨ë“  ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ë Œë”ë§
				renderTableBody(document.getElementById('tbodyKorea'), koreaStocks, true, 'korea', true);
				renderMobileList(document.getElementById('listKorea'), koreaStocks, true, 'korea', true);

				renderTableBody(document.getElementById('tbodyUSA'), usaStocks, false, 'usa', true);
				renderMobileList(document.getElementById('listUSA'), usaStocks, false, 'usa', true);

				updatePlaceholders();
				updateGlobalTime('korea'); // ì´ˆê¸° íƒ­ ê¸°ì¤€ ì‹œê°„ ì„¤ì •

			} catch (e) {
				console.error("Config Load Error:", e);
				alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
			} finally {
				// ëª¨ë“  ì‘ì—… ì™„ë£Œ í›„ ë¡œë”© í™”ë©´ ì œê±°
				document.getElementById('pageLoading').classList.add('hidden');
			}
		}

		// [ì‹ ê·œ] ê°œë³„ ì£¼ì‹ ë°ì´í„° Fetch í—¬í¼ í•¨ìˆ˜
		async function fetchStockData(item) {
			try {
				const res = await fetch(`${API_URL}?ticker=${item.code}`);
				const data = await res.json();

				if (data.result === false || data.error) throw new Error("API Error");

				const calculatedTarget = calculateTarget(data, item);

				// ì›ë³¸ ê°ì²´ì— ë°ì´í„° ì£¼ì…
				item.fetchedData = {
					...data,
					name: item.name,
					targetDiv: item.targetDiv,
					targetPer: item.targetPer,
					targetPrice: calculatedTarget
				};
				item.isLoading = null;
				item.error = false;
				return item;

			} catch (err) {
				console.error(`Failed: ${item.name}`, err);
				item.error = true;
				item.isLoading = null;
				return item;
			}
		}

		// [ì‹ ê·œ] ë¦¬ìŠ¤íŠ¸ ì „ì²´ë¥¼ ë³‘ë ¬ë¡œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
		async function batchFetchStocks(stockList) {
			if (stockList.length === 0) return;
			// ì´ë¯¸ ë°ì´í„°ê°€ ìˆëŠ” ê²ƒì€ ê±´ë„ˆë›°ê³  ì—†ëŠ” ê²ƒë§Œ fetch
			const itemsToFetch = stockList.filter(item => !item.fetchedData);
			// ë³‘ë ¬ ì²˜ë¦¬ (Wait until all finish)
			await Promise.all(itemsToFetch.map(item => fetchStockData(item)));
		}

		// [ìˆ˜ì •] ì‹œê°„ ì—…ë°ì´íŠ¸ í—¬í¼
		function updateGlobalTime(country) {
			const stockList = country === 'korea' ? koreaStocks : usaStocks;
			const validItem = stockList.find(item => item.fetchedData && item.fetchedData.time);
			if (validItem) {
				document.getElementById('globalTime').innerText = validItem.fetchedData.time;
			} else {
				document.getElementById('globalTime').innerText = "ì—…ë°ì´íŠ¸ ëŒ€ê¸°ì¤‘...";
			}
		}

		// ---------------- UI ë° ì¼ë°˜ ë¡œì§ ----------------

		function toggleViewMode() {
			const body = document.body;
			const isPcWidth = window.innerWidth > 768;
			const hasForcePc = body.classList.contains('force-pc');
			const hasForceMobile = body.classList.contains('force-mobile');

			if (isPcWidth) {
				if (hasForceMobile) body.classList.remove('force-mobile');
				else body.classList.add('force-mobile');
			} else {
				if (hasForcePc) body.classList.remove('force-pc');
				else body.classList.add('force-pc');
			}
			updateButtonState();
		}

		function updateButtonState() {
			const body = document.body;
			const btnIcon = document.querySelector('#viewToggleBtn i');
			const btnText = document.querySelector('#viewToggleBtn span');
			const isPcWidth = window.innerWidth > 768;
			const hasForcePc = body.classList.contains('force-pc');
			const hasForceMobile = body.classList.contains('force-mobile');

			if (hasForceMobile) {
				btnIcon.className = "fas fa-desktop";
				btnText.innerText = "PC í™”ë©´ ë³µê·€";
				return;
			}
			if (hasForcePc) {
				btnIcon.className = "fas fa-mobile-alt";
				btnText.innerText = "ëª¨ë°”ì¼ í™”ë©´ ë³µê·€";
				return;
			}

			if (isPcWidth) {
				btnIcon.className = "fas fa-mobile-alt";
				btnText.innerText = "ëª¨ë°”ì¼ í™”ë©´ ë³´ê¸°";
			} else {
				btnIcon.className = "fas fa-desktop";
				btnText.innerText = "PC í™”ë©´ ë³´ê¸°";
			}
		}

		window.addEventListener('resize', () => {
			updateButtonState();
		});

		// ---------------- ëª¨ë‹¬ ë° ë°ì´í„° ë¡œì§ ----------------

		function validateNumberInput(input) {
			const valid = /^[0-9.]*$/.test(input.value);
			if (!valid) {
				alert("ìˆ«ì(%)ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
				input.value = "";
				const otherId = input.id === 'inputDiv' ? 'inputPer' : 'inputDiv';
				handleInputMutex(input.id, otherId);
			}
		}

		function handleInputMutex(activeId, passiveId) {
			const activeInput = document.getElementById(activeId);
			const passiveInput = document.getElementById(passiveId);

			if (activeInput.value.length > 0) {
				passiveInput.disabled = true;
				passiveInput.value = "";
			} else {
				passiveInput.disabled = false;
			}
		}

		function validateStockCode(code, country) {
			if (country === 'korea') {
				return /^[0-9A-Z]{6}$/.test(code);
			} else {
				return /^[A-Z]+$/.test(code);
			}
		}

		function updatePlaceholders() {
			const country = document.getElementById('inputCountry').value;
			const nameInput = document.getElementById('inputName');
			const codeInput = document.getElementById('inputCode');

			if (country === 'korea') {
				nameInput.placeholder = "ì˜ˆ: ì‚¼ì„±ì „ì";
				codeInput.placeholder = "ì˜ˆ: 005930";
			} else {
				nameInput.placeholder = "ì˜ˆ: Apple";
				codeInput.placeholder = "ì˜ˆ: AAPL";
			}
		}

		function toggleModal(mode, data = null) {
			const modal = document.getElementById('stockModal');
			const title = document.getElementById('modalTitle');
			const submitBtn = document.getElementById('modalSubmitBtn');
			const modeInput = document.getElementById('modalMode');
			const countrySelect = document.getElementById('inputCountry');

			document.getElementById('inputName').value = '';
			document.getElementById('inputCode').value = '';
			document.getElementById('inputDiv').value = '';
			document.getElementById('inputPer').value = '';
			document.getElementById('editOriginalCode').value = '';

			document.getElementById('inputDiv').disabled = false;
			document.getElementById('inputPer').disabled = false;

			modeInput.value = mode;

			if (mode === 'add') {
				title.innerText = "ê´€ì‹¬ ì¢…ëª© ì¶”ê°€ (ì„ì‹œ)";
				submitBtn.innerText = "ì¶”ê°€í•˜ê¸°";
				countrySelect.disabled = false;

				const activeTab = document.querySelector('.tab-btn.active');
				if (activeTab && activeTab.id === 'tab-btn-usa') {
					countrySelect.value = 'usa';
				} else {
					countrySelect.value = 'korea';
				}

			} else if (mode === 'edit' && data) {
				title.innerText = "ê´€ì‹¬ ì¢…ëª© ìˆ˜ì • (ì„ì‹œ)";
				submitBtn.innerText = "ìˆ˜ì •í•˜ê¸°";
				countrySelect.value = data.country;
				countrySelect.disabled = true;

				document.getElementById('inputName').value = data.name;
				document.getElementById('inputCode').value = data.code;

				if (data.targetDiv) {
					document.getElementById('inputDiv').value = data.targetDiv;
					handleInputMutex('inputDiv', 'inputPer');
				}
				if (data.targetPer) {
					document.getElementById('inputPer').value = data.targetPer;
					handleInputMutex('inputPer', 'inputDiv');
				}

				document.getElementById('editOriginalCode').value = data.code;
			}

			updatePlaceholders();
			modal.classList.add('open');
		}

		function closeModal() {
			document.getElementById('stockModal').classList.remove('open');
		}

		let isOverlayTarget = false;

		function checkOverlayClick(event) {
			if (event.target === event.currentTarget) {
				isOverlayTarget = true;
			} else {
				isOverlayTarget = false;
			}
		}

		function handleOverlayClick(event) {
			if (isOverlayTarget && event.target === event.currentTarget) {
				closeModal();
			}
			isOverlayTarget = false;
		}

		function handleModalSubmit() {
			const mode = document.getElementById('modalMode').value;
			const country = document.getElementById('inputCountry').value;
			const name = document.getElementById('inputName').value.trim();
			let code = document.getElementById('inputCode').value.trim();
			if (country === 'usa') code = code.toUpperCase();

			if (!validateStockCode(code, country)) {
				if (country === 'korea') alert("í•œêµ­ ì¢…ëª© ì½”ë“œëŠ” ìˆ«ì/ëŒ€ë¬¸ì 6ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.");
				else alert("ë¯¸êµ­ ì¢…ëª© ì½”ë“œëŠ” ì•ŒíŒŒë²³ ëŒ€ë¬¸ìì—¬ì•¼ í•©ë‹ˆë‹¤.");
				return;
			}

			const divVal = document.getElementById('inputDiv').value;
			const perVal = document.getElementById('inputPer').value;
			const div = divVal ? parseFloat(divVal) : null;
			const per = perVal ? parseFloat(perVal) : null;

			if (!name || !code) {
				alert("ê¸°ì—…ëª…ê³¼ ì¢…ëª©ì½”ë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
				return;
			}

			const targetArray = country === 'korea' ? koreaStocks : usaStocks;

			// [ì¡°ê±´ 3] ì¢…ëª© ì¶”ê°€ë‚˜ ìˆ˜ì •í• ë•ŒëŠ” í•˜ë‚˜ì”© ì¶”ê°€/ìˆ˜ì • ê·¸ëŒ€ë¡œ ì²˜ë¦¬.
			// ì´ë¥¼ ìœ„í•´ ìƒíƒœê°’ ì„¸íŒ… í›„ fetchAndRenderIndividual í˜¸ì¶œ
			let targetItem = null;

			if (mode === 'add') {
				const newItem = {
					name: name,
					code: code,
					targetDiv: div,
					targetPer: per,
					fetchedData: null,
					isLoading: 'add'
				};
				targetArray.push(newItem);
				targetItem = newItem;
			} else if (mode === 'edit') {
				const originalCode = document.getElementById('editOriginalCode').value;
				const idx = targetArray.findIndex(item => item.code === originalCode);
				if (idx !== -1) {
					targetArray[idx] = {
						...targetArray[idx],
						name: name,
						code: code,
						targetDiv: div,
						targetPer: per,
						fetchedData: null, // ë°ì´í„° ì¬ë¡œë”©ì„ ìœ„í•´ ì´ˆê¸°í™”
						isLoading: 'edit'
					};
					targetItem = targetArray[idx];
				}
			}

			switchTab(country); // íƒ­ ì „í™˜
			closeModal();

			// ê°œë³„ í•­ëª© ì—…ë°ì´íŠ¸ ì‹¤í–‰
			if (targetItem) {
				fetchAndRenderIndividual(targetItem, country);
			}
		}

		function openEditModal(code, country) {
			const targetArray = country === 'korea' ? koreaStocks : usaStocks;
			const item = targetArray.find(s => s.code === code);
			if (item) {
				toggleModal('edit', { ...item, country: country });
			}
		}

		// ---------------- API ë° ë Œë”ë§ ë¡œì§ ----------------

		function calculateTarget(data, config) {
			try {
				if (config.targetDiv) {
					if (!data.divAmt) return 0;
					return data.divAmt / (config.targetDiv / 100);
				}
				if (config.targetPer) {
					if (!data.eps) return 0;
					return data.eps * config.targetPer;
				}
				return "no data";
			} catch (e) { return "err"; }
		}

		function getAction(current, target) {
			if (typeof target === 'string') return { text: "íŒë‹¨ë¶ˆê°€", class: "nodata" };
			if (!current) return { text: "ë¡œë”©ì¤‘", class: "nodata" };
			if (current < target) return { text: "ë§¤ìˆ˜", class: "buy" };
			else if (current > target * 1.2) return { text: "ë§¤ë„", class: "sell" };
			else return { text: "ë³´ìœ ", class: "hold" };
		}

		// [ì‹ ê·œ] ê°œë³„ í•­ëª© ì¶”ê°€/ìˆ˜ì •ìš© ë Œë”ë§ í•¨ìˆ˜ (ì¡°ê±´ 3 ë§Œì¡±)
		async function fetchAndRenderIndividual(item, country) {
			const tbody = document.getElementById(country === 'korea' ? 'tbodyKorea' : 'tbodyUSA');
			const mobileList = document.getElementById(country === 'korea' ? 'listKorea' : 'listUSA');
			const stockList = country === 'korea' ? koreaStocks : usaStocks;
			const isKorea = country === 'korea';

			// 1. ë¡œë”© ìƒíƒœ ë Œë”ë§
			renderTableBody(tbody, stockList, isKorea, country, false);
			renderMobileList(mobileList, stockList, isKorea, country, false);

			// 2. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
			await fetchStockData(item);

			// 3. ì™„ë£Œ í›„ ë‹¤ì‹œ ë Œë”ë§
			renderTableBody(tbody, stockList, isKorea, country, false);
			renderMobileList(mobileList, stockList, isKorea, country, false);
			updateGlobalTime(country);
		}


		// [ìˆ˜ì •] ë Œë”ë§ í•¨ìˆ˜ì— ì• ë‹ˆë©”ì´ì…˜ í”Œë˜ê·¸(isInitial) ì¶”ê°€
		function renderTableBody(tbody, dataList, isKorea, countryName, isInitial = false) {
			tbody.innerHTML = "";

			dataList.forEach((item, index) => {
				const codeStr = item.ticker || item.code;

				// ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤/ìŠ¤íƒ€ì¼ (ì¡°ê±´ 4)
				// ì´ˆê¸° ë¡œë”©ì¼ ë•Œë§Œ ì ìš©, ìˆœì°¨ì ìœ¼ë¡œ ë‚´ë ¤ì˜¤ë„ë¡ ë”œë ˆì´ ì ìš©
				let animClass = "";
				let animStyle = "";
				if (isInitial) {
					animClass = "anim-row";
					animStyle = `animation-delay: ${index * 0.05}s`; // 0.05ì´ˆ ê°„ê²©
				}

				if (item.isLoading) {
					const statusText = item.isLoading === 'add' ? 'ì¶”ê°€ì¤‘...' : 'ìˆ˜ì •ì¤‘...';
					tbody.innerHTML += `
						<tr>
							<td>
								<div class="name-wrapper">
									<div class="name-row">
										<span class="stock-name">${item.name}</span>
									</div>
									<span class="stock-code">${codeStr}</span>
								</div>
							</td>
							<td class="input-val">${item.targetDiv ? item.targetDiv + "%" : ""}</td>
							<td class="input-val">${item.targetPer || ""}</td>
							<td style="text-align:center;"><span class="badge loading">${statusText}</span></td>
							<td colspan="12" style="text-align:center; color:#999;">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.</td>
						</tr>`;
					return;
				}

				const data = item.fetchedData || item;

				if (item.error) {
					tbody.innerHTML += `
						<tr class="${animClass}" style="${animStyle}">
							<td>
								<div class="name-wrapper">
									<div class="name-row">
										<span class="stock-name">${item.name}</span>
										<button class="btn-edit-stock" onclick="openEditModal('${codeStr}', '${countryName}')"><i class="fas fa-pen"></i></button>
									</div>
									<span class="stock-code">${codeStr}</span>
								</div>
							</td>
							<td colspan="15" style="text-align:center; color:#999;">ì½”ë“œí™•ì¸/ì—ëŸ¬</td>
						</tr>`;
					return;
				}

				if (!data.price && !data.error) return;

				const action = getAction(data.price, data.targetPrice);
				const curr = isKorea ? "â‚©" : "$";
				const fmt = (n) => n ? n.toLocaleString(undefined, { maximumFractionDigits: isKorea ? 0 : 2 }) : "-";
				const fmtPct = (n) => n ? (n * 100).toFixed(2) + "%" : "0.00%";

				const changeVal = data.changeRate || 0;
				const dropVal = data.dropRate || 0;

				const changeW = Math.min((Math.abs(changeVal) / FIX_SCALE_CHANGE) * 100, 100);
				const dropW = Math.min((Math.abs(dropVal) / FIX_SCALE_DROP) * 100, 100);

				const changeColor = changeVal < 0 ? "#0051c7" : "#e31b23";
				const dropColor = Math.abs(dropVal) > FIX_SCALE_DROP ? "#6f42c1" : "#0051c7";

				let marketCap = data.marketCap || "-";
				if (marketCap.includes("ì¡° ")) marketCap = marketCap.replace("ì¡° ", "ì¡°<br>");

				const tr = `
					<tr class="${animClass}" style="${animStyle}">
						<td style="text-align:left;">
							<div class="name-wrapper">
								<div class="name-row">
									<span class="stock-name" title="${data.name}">${data.name}</span>
									<button class="btn-edit-stock" onclick="openEditModal('${codeStr}', '${countryName}')"><i class="fas fa-pen"></i></button>
								</div>
								<span class="stock-code">${codeStr}</span>
							</div>
						</td>
						<td class="input-val">${data.targetDiv ? data.targetDiv.toFixed(2) + "%" : ""}</td>
						<td class="input-val">${data.targetPer || ""}</td>
						<td style="text-align:center;"><span class="badge ${action.class}">${action.text}</span></td>
						<td title="${curr}${fmt(data.targetPrice)}" style="color:#666;">${curr}${fmt(data.targetPrice)}</td>
						<td title="${curr}${fmt(data.price)}" style="font-weight:700;">${curr}${fmt(data.price)}</td>
						<td>
							<div class="graph-wrapper">
								<span class="${changeVal > 0 ? 'up' : changeVal < 0 ? 'down' : ''}">${fmtPct(changeVal)}</span>
								<div class="bar-track"><div class="bar-fill" style="width:${changeW}%; background:${changeColor}; margin-${changeVal < 0 ? 'left' : 'right'}:auto;"></div></div>
							</div>
						</td>
						<td title="${curr}${fmt(data.high52)}">${curr}${fmt(data.high52)}</td>
						<td>
							<div class="graph-wrapper">
								<span class="down">${fmtPct(dropVal)}</span>
								<div class="bar-track"><div class="bar-fill" style="width:${dropW}%; background:${dropColor}; margin-left:auto;"></div></div>
							</div>
						</td>
						<td style="line-height:1.2; font-size:12px;">${marketCap}</td>
						<td title="${data.per}">${data.per || '-'}</td>
						<td title="${curr}${fmt(data.eps)}">${curr}${fmt(data.eps)}</td>
						<td title="${data.pbr}">${data.pbr || '-'}</td>
						<td title="${fmtPct(data.divYield)}" style="color:#e31b23; font-weight:600;">${fmtPct(data.divYield)}</td>
						<td title="${curr}${fmt(data.divAmt)}">${curr}${fmt(data.divAmt)}</td>
						<td title="${fmtPct(data.payout)}">${fmtPct(data.payout)}</td>
					</tr>`;
				tbody.innerHTML += tr;
			});
		}

		function renderMobileList(container, dataList, isKorea, countryName, isInitial = false) {
			container.innerHTML = "";

			dataList.forEach((item, index) => {
				const codeStr = item.ticker || item.code;

				let animClass = "";
				let animStyle = "";
				if (isInitial) {
					animClass = "anim-row";
					animStyle = `animation-delay: ${index * 0.05}s`;
				}

				if (item.isLoading) {
					const statusText = item.isLoading === 'add' ? 'ì¶”ê°€ì¤‘...' : 'ìˆ˜ì •ì¤‘...';
					container.innerHTML += `
						<div class="mobile-card">
							<div class="m-header">
								<div class="m-stock-info"><h3>${item.name}</h3><span>${codeStr}</span></div>
								<span class="badge loading">${statusText}</span>
							</div>
							<div style="text-align:center; padding:20px; color:#888;">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
						</div>`;
					return;
				}

				const data = item.fetchedData || item;

				if (item.error) {
					container.innerHTML += `
						<div class="mobile-card ${animClass}" style="${animStyle}">
							<button class="mobile-edit-btn" onclick="openEditModal('${codeStr}', '${countryName}')"><i class="fas fa-pen"></i></button>
							<div class="m-header"><h3>${item.name}</h3><span>${codeStr}</span><span class="badge nodata">ì—ëŸ¬</span></div>
							<div style="text-align:center; color:#999; padding:10px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>
						</div>`;
					return;
				}

				if (!data.price && !data.error) return;

				const action = getAction(data.price, data.targetPrice);
				const curr = isKorea ? "â‚©" : "$";
				const fmt = (n) => n ? n.toLocaleString(undefined, { maximumFractionDigits: isKorea ? 0 : 2 }) : "-";
				const fmtPct = (n) => n ? (n * 100).toFixed(2) + "%" : "0.00%";

				const changeVal = data.changeRate || 0;
				const dropVal = data.dropRate || 0;
				const changeColor = changeVal < 0 ? "#0051c7" : "#e31b23";

				const changeW = Math.min((Math.abs(changeVal) / FIX_SCALE_CHANGE) * 100, 100);
				const dropW = Math.min((Math.abs(dropVal) / FIX_SCALE_DROP) * 100, 100);
				const dropColor = Math.abs(dropVal) > FIX_SCALE_DROP ? "#6f42c1" : "#0051c7";

				const cardHtml = `
					<div class="mobile-card ${animClass}" style="${animStyle}">
						<div class="m-header">
							<div class="m-stock-info">
								<h3>
									${data.name}
									<button class="mobile-edit-btn" onclick="openEditModal('${codeStr}', '${countryName}')"><i class="fas fa-pen"></i></button>
								</h3>
								<span>${codeStr}</span>
							</div>
							<span class="badge ${action.class}" style="font-size:14px; padding:6px 12px;">${action.text}</span>
						</div>
						<div class="m-body">
							<div class="m-price-row">
								<div class="m-current-price ${changeVal > 0 ? 'up' : (changeVal < 0 ? 'down' : '')}">
									${curr}${fmt(data.price)}
								</div>
								<div class="m-target-price">
									ëª©í‘œê°€ <strong>${curr}${fmt(data.targetPrice)}</strong>
								</div>
							</div>
							<div class="m-graphs">
								<div class="m-bar-group">
									<div class="m-bar-label">
										<span>ë“±ë½ë¥ </span>
										<span class="${changeVal > 0 ? 'up' : (changeVal < 0 ? 'down' : '')}">${fmtPct(changeVal)}</span>
									</div>
									<div class="m-bar-bg">
										<div class="m-bar-fill" style="width:${changeW}%; background-color:${changeColor}; margin-${changeVal < 0 ? 'left' : 'right'}: auto;"></div>
									</div>
								</div>
								<div class="m-bar-group">
									<div class="m-bar-label">
										<span>ê³ ì ëŒ€ë¹„</span>
										<span class="down">${fmtPct(dropVal)}</span>
									</div>
									<div class="m-bar-bg">
										<div class="m-bar-fill" style="width:${dropW}%; background-color:${dropColor}; margin-left: auto;"></div>
									</div>
								</div>
							</div>
							<div class="m-grid">
								<div class="m-grid-item">
									<span class="m-grid-label">ë°°ë‹¹ë¥ </span>
									<span class="m-grid-value up">${fmtPct(data.divYield)}</span>
								</div>
								<div class="m-grid-item">
									<span class="m-grid-label">PER</span>
									<span class="m-grid-value">${data.per || '-'}</span>
								</div>
								<div class="m-grid-item">
									<span class="m-grid-label">52ì£¼ ìµœê³ </span>
									<span class="m-grid-value">${curr}${fmt(data.high52)}</span>
								</div>
							</div>
						</div>
					</div>`;
				container.innerHTML += cardHtml;
			});
		}

		function switchTab(country) {
			// 1. íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ í™œì„±í™”
			document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
			const targetBtn = document.getElementById(`tab-btn-${country}`);
			if (targetBtn) targetBtn.classList.add('active');

			// 2. ì»¨í…ì¸  ì„¹ì…˜ í™œì„±í™”
			document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
			document.getElementById(country).classList.add('active');

			// 3. ì‹œê°„ ì—…ë°ì´íŠ¸ (ì´ë¯¸ ë°ì´í„° ë¡œë“œë¨)
			updateGlobalTime(country);
		}

		window.onload = () => {
			updateButtonState();
			loadSheetConfig();
		};
	</script>
</body>

</html>
